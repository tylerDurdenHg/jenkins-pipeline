pipeline {
agent any
    tools {
        maven 'Maven'
    }
     environment {
     VERSION = 'latest'
    }
    stages {
        stage('Preparation') {
           steps {
               println "Jenkins job: ${env.JOB_NAME} num: #${env.BUILD_NUMBER} has started..."
           }
        }
        stage('Code Quality') {
           steps {
               sh 'echo check sonar/quality tools'
           }
        }
        stage('Compile') {
           steps {
               sh 'mvn -f mypipe/pom.xml compile'
           }
        }
        stage('Unit Tests') {
           steps {
               sh 'mvn -f mypipe/pom.xml test'
           }
        }
        stage('Integration Test') {
           steps {
               sh 'mvn -f mypipe/pom.xml verify -DskipUnitTests'
           }
        }
        stage('Upload Image') {
           steps {
               script {
                   if (env.BRANCH_NAME == 'development') {
	        	  	 sh 'echo development registry pushing'
	        	 	}
				   if (env.BRANCH_NAME == 'master') {
	               	 sh 'echo docker url: $REGISTRY and version: $VERSION'				   	
	               	 sh 'echo master registry pushing'
	        	 }
               }
           }
        }
        stage('Delete Pod') {
           steps {
               sh 'echo remove image from Kubernetes'
           }
        }
    }
    post {
        always {
            junit 'mypipe/target/surefire-reports/*.xml'
        }
     }
}